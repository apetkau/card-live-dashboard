#!/usr/bin/env python
import sys
from pathlib import Path
from werkzeug.middleware.profiler import ProfilerMiddleware

import card_live_dashboard.app

# Instructions for running Flask (used by Dash) with a profiler from
# <https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-debugging-testing-and-profiling>
if __name__ == '__main__':
    if len(sys.argv) > 1:
        card_live_home = Path(sys.argv[1])
    else:
        card_live_home = card_live_dashboard.app.DEFAULT_CARD_LIVE_HOME

    app = card_live_dashboard.app.build_app(card_live_home=card_live_home)

    flask_app = app.server
    flask_app.wsgi_app = ProfilerMiddleware(
        flask_app.wsgi_app,
        sort_by=('cumulative', 'nfl'),
        restrictions=['card_live_dashboard', 20])

    app.run_server(debug = True,
                  port = 8050,
                  host = '0.0.0.0')